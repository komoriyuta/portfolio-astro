---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import tagCategoriesData from "../content/data/tag-categories.json";

const allProjects = await getCollection("projects");
const projects = allProjects.sort(
	(a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) =>
		b.data.date.valueOf() - a.data.date.valueOf()
);

const allTags = Array.from(
	new Set(projects.flatMap((p) => p.data.tags))
).sort();

type TagCategories = Record<string, string[]>;
const tagCategories: TagCategories = tagCategoriesData;

// Group tags by the mapping, fallback to "Others"
const groupedTags: Record<string, string[]> = {};
const unmappedTags: string[] = [];

allTags.forEach((tag) => {
	let matchedCategory = null;
	for (const [category, tagsInCat] of Object.entries(tagCategories)) {
		if (tagsInCat.includes(tag)) {
			matchedCategory = category;
			break;
		}
	}
	if (matchedCategory) {
		if (!groupedTags[matchedCategory]) groupedTags[matchedCategory] = [];
		groupedTags[matchedCategory].push(tag);
	} else {
		unmappedTags.push(tag);
	}
});

// Preserve the order defined in the JSON keys
const categoryEntries = Object.keys(tagCategories)
	.filter((cat) => groupedTags[cat] && groupedTags[cat].length > 0)
	.map((cat) => ({ category: cat, tags: groupedTags[cat] }));

if (unmappedTags.length > 0) {
	categoryEntries.push({ category: "ãã®ä»–", tags: unmappedTags });
}
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="generator" content={Astro.generator} />
		<title>Yuta Komori â€” Portfolio</title>
		<meta
			name="description"
			content="å°æ£®æ‚ å¤ªã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã€‚æ©Ÿæ¢°å­¦ç¿’ã€çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ¼ãƒˆãªã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´¹ä»‹ã€‚"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap"
			rel="stylesheet"
		/>
		<script is:inline>
			const theme = (() => {
				if (
					typeof localStorage !== "undefined" &&
					localStorage.getItem("theme")
				) {
					return localStorage.getItem("theme");
				}
				if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
					return "dark";
				}
				return "light";
			})();
			if (theme === "dark") {
				document.documentElement.classList.add("dark");
			}
			window.localStorage.setItem("theme", theme);
		</script>
	</head>
	<body>
		<!-- Hero -->
		<header class="hero">
			<div class="hero__inner">
				<h1 class="hero__name fade-in">
					<span class="hero__name-ja">å°æ£® æ‚ å¤ª</span>
					<span class="hero__name-en">Yuta Komori</span>
				</h1>
				<p class="hero__tagline fade-in" style="--delay: 0.15s">
					æ©Ÿæ¢°å­¦ç¿’ãƒ»çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ãƒ»ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ¼ãƒˆã®<br
						class="sp-hide"
					/>
					äº¤å·®ç‚¹ã‚’æ¢ç©¶ã™ã‚‹å·¥å­¦éƒ¨ç”Ÿ
				</p>
				<div class="hero__links fade-in" style="--delay: 0.3s">
					<a
						href="https://github.com/komoriyuta"
						class="hero__link"
						target="_blank"
						rel="noopener noreferrer"
					>
						<svg
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="currentColor"
							><path
								d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
							></path>
						</svg>
						GitHub
					</a>
					<button
						id="theme-toggle"
						class="hero__link theme-toggle"
						aria-label="Toggle theme"
					>
						<svg
							class="sun-icon"
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							><circle cx="12" cy="12" r="5"></circle><line
								x1="12"
								y1="1"
								x2="12"
								y2="3"></line><line
								x1="12"
								y1="21"
								x2="12"
								y2="23"></line><line
								x1="4.22"
								y1="4.22"
								x2="5.64"
								y2="5.64"></line><line
								x1="18.36"
								y1="18.36"
								x2="19.78"
								y2="19.78"></line><line
								x1="1"
								y1="12"
								x2="3"
								y2="12"></line><line
								x1="21"
								y1="12"
								x2="23"
								y2="12"></line><line
								x1="4.22"
								y1="19.78"
								x2="5.64"
								y2="18.36"></line><line
								x1="18.36"
								y1="5.64"
								x2="19.78"
								y2="4.22"></line>
						</svg>
						<svg
							class="moon-icon"
							width="18"
							height="18"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							style="display: none;"
							><path
								d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
							></path>
						</svg>
					</button>
				</div>
			</div>
		</header>

		<!-- About -->
		<section class="section" id="about">
			<div class="container">
				<h2 class="section__title fade-in">Profile</h2>
				<div class="about__grid">
					<div class="about__block fade-in" style="--delay: 0.05s">
						<h3 class="about__heading">å­¦æ­´</h3>
						<dl class="about__dl">
							<div class="about__dl-row">
								<dt>2024.04 â€“</dt>
								<dd>
									æ±äº¬è¾²å·¥å¤§å­¦ å·¥å­¦éƒ¨ çŸ¥èƒ½æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ å·¥å­¦ç§‘
								</dd>
							</div>
							<div class="about__dl-row">
								<dt>â€“ 2024.03</dt>
								<dd>
									æ±äº¬å·¥æ¥­å¤§å­¦é™„å±ç§‘å­¦æŠ€è¡“é«˜ç­‰å­¦æ ¡
									æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ åˆ†é‡
								</dd>
							</div>
						</dl>
					</div>
					<div class="about__block fade-in" style="--delay: 0.1s">
						<h3 class="about__heading">è³‡æ ¼</h3>
						<ul class="about__list">
							<li>åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“</li>
							<li>å±é™ºç‰©å–æ‰±è€… ä¹™ç¨®ç¬¬å››é¡</li>
							<li>æ™®é€šè‡ªå‹•è»Šç¬¬ä¸€ç¨®é‹è»¢å…è¨±</li>
						</ul>
					</div>
					<div class="about__block fade-in" style="--delay: 0.15s">
						<h3 class="about__heading">è¶£å‘³</h3>
						<p class="about__text">
							ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€é›»å­å·¥ä½œã€ãƒ†ã‚¯ãƒãƒ»ãƒã‚¦ã‚¹éŸ³æ¥½
						</p>
					</div>
					<div class="about__block fade-in" style="--delay: 0.2s">
						<h3 class="about__heading">æ‰€å±</h3>
						<ul class="about__list">
							<li>GDGoC TUAT</li>
							<li>æ±äº¬è¾²å·¥å¤§å­¦ é›»è„³ã‚µãƒ¼ã‚¯ãƒ«</li>
						</ul>
					</div>
				</div>
			</div>
		</section>

		<!-- Skills -->
		<section class="section section--alt" id="skills">
			<div class="container">
				<h2 class="section__title fade-in">Skills & Technologies</h2>
				<div class="skills__grid">
					{
						categoryEntries.map((group, index) => (
							<div
								class="skills__group fade-in"
								style={`--delay: ${0.05 * (index + 1)}s`}
							>
								<h3 class="skills__heading">
									{group.category}
								</h3>
								<div class="skills__tags">
									{group.tags.map((tag) => (
										<a
											href={`/tags/${tag}`}
											class={
												"tag " +
												(group.category === "ML / AI"
													? "tag--primary"
													: "")
											}
											style="text-decoration: none;"
										>
											{tag}
										</a>
									))}
								</div>
							</div>
						))
					}
				</div>
			</div>
		</section>

		<!-- Projects -->
		<section class="section" id="projects">
			<div class="container">
				<h2 class="section__title fade-in">Projects</h2>
				<div class="projects__list">
					{
						projects.map((project, i) => (
							<a
								href={`/projects/${project.slug}`}
								class="project-card-link"
								style="display: block; text-decoration: none; color: inherit;"
							>
								<article
									class="project-card fade-in"
									style={`--delay: ${0.06 * (i + 1)}s`}
								>
									<div class="project-card__image">
										<Image
											src={project.data.thumbnail}
											alt={project.data.title}
										/>
									</div>
									<div class="project-card__body">
										<div class="project-card__meta">
											<span class="project-card__year">
												{project.data.period}
											</span>
											{project.data.award && (
												<span class="project-card__award">
													ğŸ† {project.data.award}
												</span>
											)}
										</div>
										<h3 class="project-card__title">
											{project.data.title}
											<span class="project-card__title-en">
												{project.data.titleEn}
											</span>
										</h3>
										<p class="project-card__desc">
											{project.data.description}
										</p>
										{project.data.result && (
											<p class="project-card__result">
												{project.data.result}
											</p>
										)}
										<div class="project-card__footer">
											<div class="project-card__tags">
												{project.data.tags.map(
													(tag) => (
														<span class="tag tag--sm">
															{tag}
														</span>
													)
												)}
											</div>
											{project.data.links && (
												<div class="project-card__links">
													{project.data.links.map(
														(link) => (
															<object>
																<a
																	href={
																		link.url
																	}
																	class="project-card__link"
																	target="_blank"
																	rel="noopener noreferrer"
																>
																	{link.label}{" "}
																	â†’
																</a>
															</object>
														)
													)}
												</div>
											)}
										</div>
									</div>
								</article>
							</a>
						))
					}
				</div>
			</div>
		</section>

		<!-- Footer -->
		<footer class="footer">
			<div class="container footer__inner">
				<p class="footer__copy">Â© 2025 Yuta Komori</p>
				<a
					href="https://github.com/komoriyuta"
					class="footer__link"
					target="_blank"
					rel="noopener noreferrer"
				>
					GitHub â†’
				</a>
			</div>
		</footer>

		<script>
			const observer = new IntersectionObserver(
				(entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							entry.target.classList.add("is-visible");
							observer.unobserve(entry.target);
						}
					});
				},
				{ threshold: 0.1, rootMargin: "0px 0px -30px 0px" }
			);
			document
				.querySelectorAll(".fade-in")
				.forEach((el) => observer.observe(el));

			// Theme toggle logic
			const themeToggle = document.getElementById(
				"theme-toggle"
			) as HTMLButtonElement | null;
			const sunIcon = document.querySelector(
				".sun-icon"
			) as HTMLElement | null;
			const moonIcon = document.querySelector(
				".moon-icon"
			) as HTMLElement | null;

			const updateThemeIcons = (isDark: boolean) => {
				if (sunIcon && moonIcon) {
					if (isDark) {
						sunIcon.style.display = "none";
						moonIcon.style.display = "block";
					} else {
						sunIcon.style.display = "block";
						moonIcon.style.display = "none";
					}
				}
			};

			// Initialize icons based on current theme
			updateThemeIcons(
				document.documentElement.classList.contains("dark")
			);

			if (themeToggle) {
				themeToggle.addEventListener("click", () => {
					const isDark =
						document.documentElement.classList.toggle("dark");
					localStorage.setItem("theme", isDark ? "dark" : "light");
					updateThemeIcons(isDark);
				});
			}
		</script>

		<style>
			/* â”€â”€â”€ Tokens â”€â”€â”€ */
			:root {
				--bg: #ffffff;
				--bg-alt: #f7f7f5;
				--text: #222;
				--text-sub: #555;
				--muted: #999;
				--primary: #3d6b5e;
				--primary-light: #eef4f1;
				--border: #e8e8e5;
				--radius: 10px;
				--font-serif: "Source Serif 4", "Noto Sans JP", serif;
				--font-sans: "Noto Sans JP", sans-serif;
				--max-w: 880px;
			}
			:root.dark {
				--bg: #111111;
				--bg-alt: #1a1a1a;
				--text: #eeeeee;
				--text-sub: #aaaaaa;
				--muted: #666666;
				--primary: #529180;
				--primary-light: #20352e;
				--border: #333333;
			}

			/* â”€â”€â”€ Reset â”€â”€â”€ */
			*,
			*::before,
			*::after {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			html {
				scroll-behavior: smooth;
				-webkit-font-smoothing: antialiased;
			}
			body {
				font-family: var(--font-sans);
				background: var(--bg);
				color: var(--text);
				font-size: 14.5px;
				line-height: 1.75;
				font-weight: 400;
			}
			.container {
				max-width: var(--max-w);
				margin: 0 auto;
				padding: 0 24px;
			}
			a {
				color: inherit;
				text-decoration: none;
			}
			ul {
				list-style: none;
			}
			img {
				display: block;
				max-width: 100%;
			}

			/* â”€â”€â”€ Animation â”€â”€â”€ */
			.fade-in {
				opacity: 0;
				transform: translateY(16px);
				transition: opacity 0.55s ease, transform 0.55s ease;
				transition-delay: var(--delay, 0s);
			}
			.fade-in.is-visible {
				opacity: 1;
				transform: translateY(0);
			}

			/* â”€â”€â”€ Hero â”€â”€â”€ */
			.hero {
				padding: 120px 24px 80px;
				text-align: center;
			}
			.hero__inner {
				max-width: 600px;
				margin: 0 auto;
			}
			.hero__name {
				margin-bottom: 20px;
			}
			.hero__name-ja {
				display: block;
				font-family: var(--font-sans);
				font-size: 14px;
				font-weight: 400;
				color: var(--muted);
				letter-spacing: 0.15em;
				margin-bottom: 6px;
			}
			.hero__name-en {
				display: block;
				font-family: var(--font-serif);
				font-size: clamp(36px, 7vw, 54px);
				font-weight: 600;
				line-height: 1.15;
				color: var(--text);
			}
			.hero__tagline {
				font-size: 15px;
				color: var(--text-sub);
				line-height: 1.8;
				margin-bottom: 28px;
			}
			.sp-hide {
			}
			.hero__links {
				display: flex;
				gap: 12px;
				justify-content: center;
			}
			.hero__link {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				font-size: 13px;
				font-weight: 500;
				color: var(--primary);
				padding: 8px 18px;
				border: 1px solid var(--border);
				border-radius: 100px;
				transition: background 0.2s, border-color 0.2s;
			}
			.hero__link:hover {
				background: var(--primary-light);
				border-color: var(--primary);
			}
			.hero__link svg {
				flex-shrink: 0;
			}
			.theme-toggle {
				cursor: pointer;
				background: transparent;
				padding: 8px;
			}
			.theme-toggle:hover {
				background: var(--bg-alt);
			}

			/* â”€â”€â”€ Section â”€â”€â”€ */
			.section {
				padding: 72px 0;
			}
			.section--alt {
				background: var(--bg-alt);
			}
			.section__title {
				font-family: var(--font-serif);
				font-size: 24px;
				font-weight: 600;
				margin-bottom: 36px;
				padding-bottom: 12px;
				border-bottom: 2px solid var(--text);
				display: inline-block;
			}

			/* â”€â”€â”€ About â”€â”€â”€ */
			.about__grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 32px 48px;
			}
			.about__heading {
				font-size: 12px;
				font-weight: 600;
				color: var(--primary);
				letter-spacing: 0.08em;
				margin-bottom: 10px;
			}
			.about__dl {
				display: flex;
				flex-direction: column;
				gap: 0;
			}
			.about__dl-row {
				display: flex;
				flex-direction: column;
				gap: 2px;
				padding: 10px 0;
				border-bottom: 1px solid var(--border);
				font-size: 13.5px;
			}
			.about__dl-row dt {
				font-size: 12px;
				color: var(--muted);
				font-weight: 500;
			}
			.about__dl-row dd {
				margin: 0;
			}
			.about__list li {
				font-size: 13.5px;
				padding: 6px 0;
				border-bottom: 1px solid var(--border);
			}
			.about__text {
				font-size: 13.5px;
				color: var(--text-sub);
			}

			/* â”€â”€â”€ Skills â”€â”€â”€ */
			.skills__grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 28px 48px;
			}
			.skills__heading {
				font-size: 12px;
				font-weight: 600;
				color: var(--muted);
				letter-spacing: 0.06em;
				margin-bottom: 10px;
				text-transform: uppercase;
			}
			.skills__tags {
				display: flex;
				flex-wrap: wrap;
				gap: 6px;
			}

			.tag {
				display: inline-block;
				padding: 5px 12px;
				font-size: 12.5px;
				font-weight: 500;
				border-radius: 6px;
				background: var(--bg);
				border: 1px solid var(--border);
				color: var(--text-sub);
				transition: border-color 0.2s;
			}
			.tag:hover {
				border-color: var(--primary);
			}
			.tag--primary {
				background: var(--primary-light);
				border-color: transparent;
				color: var(--primary);
			}
			.tag--primary:hover {
				border-color: var(--primary);
			}
			.tag--sm {
				padding: 3px 9px;
				font-size: 11.5px;
			}

			/* â”€â”€â”€ Projects â”€â”€â”€ */
			.projects__list {
				display: flex;
				flex-direction: column;
				gap: 24px;
			}

			.project-card {
				display: grid;
				grid-template-columns: 220px 1fr;
				gap: 24px;
				background: var(--bg);
				border: 1px solid var(--border);
				border-radius: var(--radius);
				overflow: hidden;
				transition: box-shadow 0.25s ease, border-color 0.25s ease;
			}
			.project-card:hover {
				border-color: #ccc;
				box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
			}

			.project-card__image {
				aspect-ratio: 4/3;
				overflow: hidden;
				background: var(--bg-alt);
				display: flex;
				align-items: center;
				justify-content: center;
			}
			.project-card__image img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				transition: transform 0.4s ease, opacity 0.3s;
			}
			:root.dark .project-card__image img {
				opacity: 0.85; /* Reduce glare in dark mode */
			}
			.project-card:hover .project-card__image img {
				transform: scale(1.03);
				opacity: 1;
			}

			.project-card__body {
				padding: 24px 24px 24px 0;
			}

			.project-card__meta {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-bottom: 8px;
				flex-wrap: wrap;
			}
			.project-card__year {
				font-size: 12px;
				font-weight: 500;
				color: var(--muted);
			}
			.project-card__award {
				font-size: 11.5px;
				font-weight: 500;
				color: var(--primary);
				background: var(--primary-light);
				padding: 2px 10px;
				border-radius: 4px;
			}
			.project-card__title {
				font-family: var(--font-serif);
				font-size: 20px;
				font-weight: 600;
				margin-bottom: 10px;
				line-height: 1.35;
			}
			.project-card__title-en {
				font-family: var(--font-sans);
				font-size: 12.5px;
				font-weight: 400;
				color: var(--muted);
				margin-left: 8px;
			}
			.project-card__desc {
				font-size: 13.5px;
				color: var(--text-sub);
				line-height: 1.75;
				margin-bottom: 10px;
			}
			.project-card__result {
				font-size: 13px;
				color: var(--primary);
				background: var(--primary-light);
				padding: 8px 14px;
				border-radius: 6px;
				margin-bottom: 14px;
				line-height: 1.6;
			}
			.project-card__footer {
				display: flex;
				align-items: flex-start;
				justify-content: space-between;
				gap: 12px;
				flex-wrap: wrap;
			}
			.project-card__tags {
				display: flex;
				flex-wrap: wrap;
				gap: 5px;
			}
			.project-card__links {
				display: flex;
				gap: 12px;
				flex-shrink: 0;
			}
			.project-card__link {
				font-size: 13px;
				font-weight: 500;
				color: var(--primary);
				transition: opacity 0.2s;
				white-space: nowrap;
			}
			.project-card__link:hover {
				opacity: 0.7;
			}

			/* â”€â”€â”€ Footer â”€â”€â”€ */
			.footer {
				padding: 32px 0;
				border-top: 1px solid var(--border);
			}
			.footer__inner {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.footer__copy {
				font-size: 12px;
				color: var(--muted);
			}
			.footer__link {
				font-size: 13px;
				font-weight: 500;
				color: var(--primary);
				transition: opacity 0.2s;
			}
			.footer__link:hover {
				opacity: 0.7;
			}

			/* â”€â”€â”€ Responsive â”€â”€â”€ */
			@media (max-width: 680px) {
				.about__grid,
				.skills__grid {
					grid-template-columns: 1fr;
					gap: 24px;
				}
				.project-card {
					grid-template-columns: 1fr;
				}
				.project-card__body {
					padding: 20px;
				}
				.project-card__image {
					aspect-ratio: 16/9;
				}
				.project-card__title-en {
					display: block;
					margin-left: 0;
					margin-top: 2px;
				}
				.section {
					padding: 56px 0;
				}
				.hero {
					padding: 80px 24px 56px;
				}
				.sp-hide {
					display: none;
				}
			}
		</style>
	</body>
</html>
